<ion-header class="ion-no-border custom-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/home"></ion-back-button>
    </ion-buttons>

    <ion-title>Analytics</ion-title>
    <ion-progress-bar *ngIf="showProgress" type="indeterminate"></ion-progress-bar>

    <ion-buttons slot="end" aria-hidden="true"></ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-grid class="balance-grid">
      <ion-row class="ion-align-items-center">
        <ion-col class="ion-col-items">
          <p class="balance-title">Total Balance</p>
          <h1 class="balance-amount">21 350.54 €</h1>
        </ion-col>
        <ion-col size="auto">
          <ion-button class="history-button" fill="clear" (click)="goToHistory()">
            <ion-icon slot="icon-only" src="assets/icons/history_transactions.svg"></ion-icon>
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  <div class="main-content">
        <div class="content-card">
      <div class="section-header">
        <h2 class="section-title">Overview</h2>
        <div class="month-selector">
          <ion-select value="month" interface="popover">
            <ion-select-option value="month">Month</ion-select-option>
            <ion-select-option value="year">Year</ion-select-option>
          </ion-select>
        </div>
      </div>

      <div class="chart-container">
        <canvas baseChart [data]="barChartData" [options]="barChartOptions" [type]="barChartType"></canvas>
      </div>
    </div>
    <!--
        <div class="summary-cards">
          <div class="summary-card income-card">
            <div class="card-icon"><ion-icon src="assets/icons/arrow-down.svg"></ion-icon></div>
            <div class="card-details">
              <p class="card-title">Income</p>
              <p class="card-amount">18 548.99 €</p>
            </div>
          </div>
          <div class="summary-card expense-card">
            <div class="card-icon"><ion-icon src="assets/icons/arrow-up.svg"></ion-icon></div>
            <div class="card-details">
              <p class="card-title">Expense</p>
              <p class="card-amount">1 445.93 €</p>
            </div>
          </div>
        </div>
      -->
    <div class="content-card">
      <h2 class="section-title">Budget</h2>
      <div class="month-chips">
        <ion-chip *ngFor="let month of months" [class.active]="month === selectedExpenseMonth"
          (click)="selectExpenseMonth(month)" [id]="'expense-month-chip-' + month">
          {{ month }}
        </ion-chip>
      </div>
      <div class="doughnut-chart-container">
        <igx-doughnut-chart height="100%" width="100%" allowSliceSelection="true" innerExtent="0.75"
          (sliceClick)="onExpenseSliceClick($event)" selectedSliceStroke="Black" selectedSliceFill="Gray"
          selectedSliceStrokeThickness="1" selectedSliceOpacity="0.75">
          <igx-ring-series [dataSource]="expenseDoughnutDataSource" valueMemberPath="Value"
            [brushes]="expenseDoughnutBrushes" outlines="white" strokeThickness="2">
          </igx-ring-series>
        </igx-doughnut-chart>

        <div class="chart-center-text">
          <p class="center-text-label">{{ selectedExpenseSliceInfo }}</p>
          <p class="center-text-value">{{ selectedExpenseSliceValue }}</p>
          <p class="center-text-sublabel">{{ centerExpenseTextSublabel }}</p>
        </div>
      </div>

      <div class="list-container">
        <div *ngFor="let item of expenseCategoryData" class="category-item">
          <div class="item-icon-wrapper" [style.background]="item.color + '20'">
            <ion-icon [src]="item.icon" [style.color]="item.color"></ion-icon>
          </div>
          <div class="item-details">
            <p class="category-name">{{ item.name }}</p>
            <p class="category-info">{{ item.percentage }}% • {{ item.transactions }} transaction(s)</p>
          </div>
          <div class="item-amount">{{ item.amount | number:'1.2-2' }} €</div>
        </div>
      </div>
    </div>

    <div class="content-card">
      <h2 class="section-title">Income</h2>
      <div class="month-chips">
        <ion-chip *ngFor="let month of months" [class.active]="month === selectedIncomeMonth"
          (click)="selectIncomeMonth(month)" [id]="'income-month-chip-' + month">
          {{ month }}
        </ion-chip>
      </div>
      <div class="doughnut-chart-container">
        <igx-doughnut-chart height="100%" width="100%" allowSliceSelection="true" innerExtent="0.75"
          (sliceClick)="onIncomeSliceClick($event)" selectedSliceStroke="Black" selectedSliceFill="Gray"
          selectedSliceStrokeThickness="1" selectedSliceOpacity="0.75">
          <igx-ring-series [dataSource]="incomeDoughnutDataSource" valueMemberPath="Value"
            [brushes]="incomeDoughnutBrushes" outlines="white" strokeThickness="2">
          </igx-ring-series>
        </igx-doughnut-chart>

        <div class="chart-center-text">
          <p class="center-text-label">{{ selectedIncomeSliceInfo }}</p>
          <p class="center-text-value">{{ selectedIncomeSliceValue }}</p>
          <p class="center-text-sublabel">{{ centerIncomeTextSublabel }}</p>
        </div>
      </div>

      <div class="list-container">
        <div *ngFor="let item of incomeCategoryData" class="category-item">
          <div class="item-icon-wrapper" [style.background]="item.color + '20'">
            <ion-icon [src]="item.icon" [style.color]="item.color"></ion-icon>
          </div>
          <div class="item-details">
            <p class="category-name">{{ item.name }}</p>
            <p class="category-info">{{ item.percentage }}% • {{ item.transactions }} transaction(s)</p>
          </div>
          <div class="item-amount">+{{ item.amount | number:'1.2-2' }} €</div>
        </div>
      </div>
    </div>

  </div>

</ion-content>