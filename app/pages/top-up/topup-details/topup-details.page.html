<ion-header class="ion-no-border custom-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="#" (click)="goBack()"></ion-back-button>
    </ion-buttons>
    <ion-title>Top-Up Details</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
    <form [formGroup]="form">
  <ion-grid>

    <!-- Selected Card -->
    <!-- Selected Source (Card or Bank) -->
  <ion-row>
    <ion-col size="12">
<ion-item button lines="none" (click)="openSelector()" class="source-selector">
  <ion-avatar slot="start" *ngIf="form.value.source">
    <img
      *ngIf="mode==='card'"
      [src]="form.value.source.logoIcon"
    />
    <img
      *ngIf="mode==='bank'"
      [src]="form.value.source.bankLogoUrl"
    />
  </ion-avatar>

  <ion-label>
    <ng-container *ngIf="form.value.source; else noSelection">
      <h2>
        {{ mode==='card'
           ? (form.value.source.brand + ' •••• ' + form.value.source.last4)
           : (form.value.source.bankName + ' •••• ' + form.value.source.last4)
        }}
      </h2>
      <p>{{ mode==='card' ? 'Selected Card' : 'Selected Bank' }}</p>
    </ng-container>

    <ng-template #noSelection>
      <h2>
        {{ mode==='card' ? 'Select a card' : 'Select a bank' }}
      </h2>
    </ng-template>
  </ion-label>

  <ion-icon name="chevron-down-outline" slot="end"></ion-icon>
</ion-item>
    </ion-col>
  </ion-row>

          <!-- Modal for selection -->
      <ion-modal [isOpen]="isSelectorOpen" (willDismiss)="onSelectorDismiss($event.detail)" [breakpoints]="[0,0.5,0.8]"
        initialBreakpoint="0.8">
        <ng-template>
          <ng-container *ngIf="mode==='bank'">
            <app-account-selector [accounts]="availableAccounts" (selected)="onSelectorDismiss({ data: $event })"
              (canceled)="isSelectorOpen=false"></app-account-selector>
          </ng-container>
          <ng-container *ngIf="mode==='card'">
            <app-card-selector [cards]="availableCards" (selected)="onSelectorDismiss({ data: $event })"
              (canceled)="isSelectorOpen=false"></app-card-selector>
          </ng-container>
        </ng-template>
      </ion-modal>

    <!-- Selected Bank -->
  <!--  <ion-row *ngIf="mode==='bank'">
      <ion-col size="12">
        <div class="mode-card mode-card--selected">
          <img class="mode-card__artwork" [src]="form.value.source?.logoIcon" *ngIf="mode==='bank'" />
          <div class="mode-card__text">
            <h2>{{ form.value.source?.bankName }}</h2>
            <p>•••• {{ form.value.source?.last4 }}</p>
          </div>
          <ion-icon name="chevron-down-outline" class="mode-card__icon"></ion-icon>
        </div>
      </ion-col>
    </ion-row>-->




    <!-- Amount Picker -->
    <ion-row class="amount-section">
  <ion-col size="12">
   <!-- <div class="field-label">Amount</div> -->
    <p class="field-subtitle">How much would you like to Top Up?</p>

    <!-- Single Editable Input with Chips -->
    <ion-item lines="none" class="amount-input-item">
      <ion-input
        formControlName="amount"
        type="number"
        inputmode="decimal"
        placeholder="0.00"
        class="amount-input"
        label="Amount" label-placement="floating" fill="solid" color="primary" class="amount-display"
      ></ion-input>
      <span class="currency-symbol">MAD</span>
    </ion-item>

    <div class="filter-chips">
      <ion-chip (click)="form.get('amount')!.setValue(100)"><ion-label>100</ion-label></ion-chip>
      <ion-chip (click)="form.get('amount')!.setValue(250)"><ion-label>250</ion-label></ion-chip>
      <ion-chip (click)="form.get('amount')!.setValue(500)"><ion-label>500</ion-label></ion-chip>
      <ion-chip (click)="form.get('amount')!.setValue(1000)"><ion-label>1000</ion-label></ion-chip>
    </div>

    <app-field-errors [control]="form.get('amount')!" fieldName="Amount"></app-field-errors>
  </ion-col>
</ion-row>


    <!-- Continue -->
    <ion-row>
      <ion-col size="12">
        <ion-button expand="block" color="primary" (click)="sendDetails()" [disabled]="form.invalid">
          Continue
        </ion-button>
      </ion-col>
    </ion-row>

  </ion-grid>
    </form>
</ion-content>
